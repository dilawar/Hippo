<?php

require_once BASEPATH.'autoload.php';

class BMVPDO extends PDO
{
    function __construct( $host = 'localhost'  )
    {
        $conf = parse_ini_file( '/etc/hipporc', $process_section = TRUE );
        $options = array ( PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION );
        $host = $conf['mysql']['host'];
        $port = $conf['mysql']['port'];

        if( $port == -1 )
            $port = 3306;

        $user = $conf['mysql']['user'];
        $password = $conf['mysql']['password'];
        $dbname = $conf['mysql']['database'];

        if( $port == -1 )
            $port = 3306;

        try {
            parent::__construct( 'mysql:host=' . $host . ";dbname=$dbname"
                , $user, $password, $options
            );
        } catch( PDOException $e) {
            echo minionEmbarrassed(
                "failed to connect to database: ".  $e->getMessage()
            );
            $this->error = $e->getMessage( );
            throw $e;
        }

    }

    public function initialize( )
    {
    
        $res = $this->query(
            'CREATE TABLE IF NOT EXISTS holidays (
                date DATE NOT NULL PRIMARY KEY
                , description VARCHAR(100) NOT NULL
                , schedule_talk_or_aws ENUM( "YES", "NO" ) DEFAULT "YES"
            )
            ' );

        // Configuration
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS config (
                id VARCHAR(100) PRIMARY KEY
                , value VARCHAR(1000) NOT NULL
                , comment TEXT
            )
            "
            );

        // Since deleting is allowed from speaker, id should not AUTO_INCREMENT
        $res = $this->query(
            'CREATE TABLE IF NOT EXISTS speakers
            (   id INT NOT NULL PRIMARY KEY
                , honorific ENUM( "Dr", "Prof", "Mr", "Ms" ) DEFAULT "Dr"
                , email VARCHAR(100)
                , first_name VARCHAR(100) NOT NULL CHECK( first_name <> "" )
                , middle_name VARCHAR(100)
                , last_name VARCHAR(100)
                , designation VARCHAR(100)
                , department VARCHAR(500)
                , institute VARCHAR(1000) NOT NULL CHECK( institute <> "" )
                , homepage VARCHAR(500)
                , UNIQUE KEY (email,first_name,last_name)
            )' );

        // Other tables.
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS logins (
                id VARCHAR( 200 )
                , login VARCHAR(100)
                , email VARCHAR(200)
                , alternative_email VARCHAR(200)
                , honorific ENUM( 'Mr', 'Ms', 'Dr', 'Prof', 'Mx', 'Misc' ) 
                , first_name VARCHAR(200)
                , last_name VARCHAR(100)
                , roles SET(
                    'USER', 'ADMIN', 'MEETINGS', 'ACAD_ADMIN', 'BOOKMYVENUE_ADMIN', 'JC_ADMIN'
                    ) DEFAULT 'USER'
                , designation VARCHAR(40) DEFAULT 'UNKNOWN'
                , last_login TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                , created_on DATETIME
                , joined_on DATE
                , eligible_for_aws ENUM ('YES', 'NO' ) DEFAULT 'NO'
                , valid_until DATE
                , status SET( 'ACTIVE', 'INACTIVE', 'TEMPORARLY_INACTIVE', 'EXPIRED' ) DEFAULT 'ACTIVE'
                , laboffice VARCHAR(200)
                , pi_or_host VARCHAR(50)
                , specialization VARCHAR(30) 
                -- The faculty fields here must match in faculty table.
                , title ENUM(
                    'FACULTY', 'POSTDOC'
                    , 'PHD', 'INTPHD', 'MSC'
                    , 'JRF', 'SRF'
                    , 'NONACADEMIC_STAFF'
                    , 'VISITOR', 'ALUMNI', 'OTHER'
                    , 'UNSPECIFIED'
                ) DEFAULT 'UNSPECIFIED'
                , institute VARCHAR(300)
                , PRIMARY KEY (login))"
            );

        $res = $this->query(
            'CREATE TABLE IF NOT EXISTS talks
            -- id should not be auto_increment.
            ( id INT NOT NULL
                -- This will be prefixed in title of event. e.g. Thesis Seminar by
                -- , Public Lecture by, seminar by etc.
                , class VARCHAR(30) NOT NULL DEFAULT "TALK"
                , speaker VARCHAR(100) NOT NULL -- This can change a little.
                , speaker_id INT NOT NULL
                , host VARCHAR(100) NOT NULL
                , coordinator VARCHAR(100)
                , title VARCHAR(500) NOT NULL
                , description MEDIUMTEXT
                , created_by VARCHAR(100) NOT NULL
                    CHECK( register_by <> "" )
                , created_on TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
                , status ENUM( "CANCELLED", "INVALID", "VALID", "DELIVERED" ) DEFAULT "VALID"
                , PRIMARY KEY (id)
            )' );

        // This table holds the email template.
        $res = $this->query(
            'CREATE TABLE IF NOT EXISTS email_templates
            ( id VARCHAR(100) NOT NULL
            , when_to_send VARCHAR(200)
            , recipients VARCHAR(200) NOT NULL
            , cc VARCHAR(500)
            , description TEXT, PRIMARY KEY (id) )'
            );

        // Save the emails here. A bot should send these emails.
        $res = $this->query(
            'CREATE TABLE IF NOT EXISTS emails
            ( id INT NOT NULL AUTO_INCREMENT
                , recipients VARCHAR(1000) NOT NULL
                , cc VARCHAR(200)
                , subject VARCHAR(1000) NOT NULL
                , msg TEXT NOT NULL
                , when_to_send DATETIME NOT NULL
                , status ENUM( "PENDING", "SENT", "FAILED", "CANCELLED" ) DEFAULT "PENDING"
                , created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                , last_tried_on DATETIME
                , PRIMARY KEY (id) )'
            );

        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS bookmyvenue_requests (
                gid INT NOT NULL
                , rid INT NOT NULL
                , class VARCHAR(30) DEFAULT 'UNKNOWN'
                , created_by VARCHAR(50) NOT NULL
                , title VARCHAR(300) NOT NULL
                , external_id VARCHAR(50)
                , description TEXT
                , venue VARCHAR(80) NOT NULL
                , date DATE NOT NULL
                , start_time TIME NOT NULL
                , end_time TIME NOT NULL
                , status ENUM ( 'PENDING', 'APPROVED', 'REJECTED', 'CANCELLED', 'EXPIRED' ) DEFAULT 'PENDING'
                , is_public_event ENUM( 'YES', 'NO' ) DEFAULT 'NO'
                , url VARCHAR( 1000 )
                , modified_by VARCHAR(50) -- Who modified the request last time.
                , last_modified_on DATETIME
                , timestamp DATETIME
                , PRIMARY KEY (gid, rid)
                , UNIQUE KEY (gid,rid,external_id)
                )
               " );
        $res = $this->query( "
            -- venues must created before events because events refer to venues key as
            -- foreign key.
            CREATE TABLE IF NOT EXISTS venues (
                id VARCHAR(80) NOT NULL
                , name VARCHAR(300) NOT NULL
                , institute VARCHAR(100) NOT NULL
                , building_name VARCHAR(100) NOT NULL
                , floor INT NOT NULL
                , location VARCHAR(500)
                , type VARCHAR(30) NOT NULL
                , strength INT NOT NULL
                , distance_from_ncbs DECIMAL(3,3) DEFAULT 0.0
                , has_projector ENUM( 'YES', 'NO' ) NOT NULL
                , suitable_for_conference ENUM( 'YES', 'NO' ) NOT NULL
                , has_skype ENUM( 'YES', 'NO' ) DEFAULT 'NO'
                -- How many events this venue have hosted so far. Meaure of popularity.
                , total_events INT NOT NULL DEFAULT 0
                , PRIMARY KEY (id) )"
            );

        // All events are put on this table.
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS events (
                -- Sub event will be parent.children format.
                gid INT NOT NULL -- This is group id of events.
                , eid INT NOT NULL -- This is event id in that group.
                -- If some details of this event are stored in some other table, use
                -- this field. Value of this field is formatted as tablename.id e.g.
                -- talks and aws can be referred as talks.3 and annual_work_seminars.5
                -- here.
                , external_id VARCHAR(50)
                -- If yes, this entry will be put on google calendar.
                , is_public_event ENUM( 'YES', 'NO' ) DEFAULT 'NO'
                , class VARCHAR(30) NOT NULL DEFAULT 'UNKNOWN'
                , title VARCHAR(300) NOT NULL
                , description TEXT
                , date DATE NOT NULL
                , venue VARCHAR(80) NOT NULL
                , created_by VARCHAR( 50 ) NOT NULL
                , start_time TIME NOT NULL
                , end_time TIME NOT NULL
                , status ENUM( 'VALID', 'INVALID', 'CANCELLED' ) DEFAULT 'VALID'
                , calendar_id VARCHAR(200)
                , calendar_event_id VARCHAR(200)
                , url VARCHAR(1000)
                , timestamp DATETIME NOT NULL
                , last_modified_on DATETIME
                , PRIMARY KEY ( gid, eid )
                , UNIQUE KEY (gid,eid,external_id)
                )"
            );

        $res = $this->query( "
            create TABLE IF NOT EXISTS supervisors (
                email VARCHAR(80) PRIMARY KEY NOT NULL
                , first_name VARCHAR( 200 ) NOT NULL
                , middle_name VARCHAR(200)
                , last_name VARCHAR( 200 )
                , affiliation VARCHAR( 1000 ) NOT NULL
                , url VARCHAR(300) ) "
            );

        $res = $this->query( "
            create TABLE IF NOT EXISTS faculty (
                email VARCHAR(80) PRIMARY KEY NOT NULL
                , first_name VARCHAR( 200 ) NOT NULL
                , middle_name VARCHAR(200)
                , last_name VARCHAR( 200 )
                , affiliation ENUM ( 'NCBS', 'INSTEM', 'OTHER' ) DEFAULT 'INSTEM'
                , status ENUM ( 'ACTIVE', 'INACTIVE', 'INVALID' ) DEFAULT 'ACTIVE'
                , institute VARCHAR( 100 )
                , url VARCHAR(300)
                , specialization VARCHAR(100)
                , created_on TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
                , modified_on DATETIME NOT NULL
                )"
            );

        // This table keeps the archive. We only move complete AWS entry in to this
        // table. Ideally this should not be touched manually.
        $res = $this->query( "
            create TABLE IF NOT EXISTS annual_work_seminars (
                id INT NOT NULL AUTO_INCREMENT PRIMARY KEY
                , speaker VARCHAR(80) NOT NULL -- user
                , date DATE NOT NULL -- final date
                , time TIME NOT NULL DEFAULT '16:00'
                , supervisor_1 VARCHAR( 200 ) NOT NULL -- first superviser must be from NCBS
                , supervisor_2 VARCHAR( 200 ) -- superviser 2, optional
                , tcm_member_1 VARCHAR( 200 ) -- Can be null at the time of inserting a query.
                , tcm_member_2 VARCHAR( 200 ) -- optional
                , tcm_member_3 VARCHAR( 200 ) -- optional
                , tcm_member_4 VARCHAR( 200 ) -- optional
                , title VARCHAR( 1000 )
                , abstract MEDIUMTEXT
                , is_presynopsis_seminar ENUM( 'YES', 'NO' ) default 'NO'
                , FOREIGN KEY (speaker) REFERENCES logins(login)
                , UNIQUE KEY (speaker, date)
                )"
            );

        $res = $this->query( "
            create TABLE IF NOT EXISTS upcoming_aws (
                id INT AUTO_INCREMENT PRIMARY KEY
                , speaker VARCHAR(80) NOT NULL -- user
                , date DATE NOT NULL -- tentative date
                , time TIME NOT NULL DEFAULT '16:00'
                , supervisor_1 VARCHAR( 200 )
                , supervisor_2 VARCHAR( 200 )
                , tcm_member_1 VARCHAR( 200 )
                , tcm_member_2 VARCHAR( 200 )
                , tcm_member_3 VARCHAR( 200 )
                , tcm_member_4 VARCHAR( 200 )
                , title VARCHAR( 1000 )
                , abstract MEDIUMTEXT
                , status ENUM( 'VALID', 'INVALID' ) DEFAULT 'VALID'
                , comment TEXT
                , acknowledged ENUM( 'YES', 'NO' ) DEFAULT 'NO'
                , is_presynopsis_seminar ENUM( 'YES', 'NO' ) default 'NO'
                , FOREIGN KEY (speaker) REFERENCES logins(login)
                , UNIQUE (speaker, date) )"
            );

        $res = $this->query( "
            create TABLE IF NOT EXISTS aws_requests (
                id INT AUTO_INCREMENT PRIMARY KEY
                , speaker VARCHAR(200) NOT NULL -- user
                , date DATE -- final date
                , time TIME DEFAULT '16:00'
                , is_presynopsis_seminar ENUM( 'YES', 'NO' ) DEFAULT 'NO'
                , supervisor_1 VARCHAR( 200 ) -- first superviser must be from NCBS
                , supervisor_2 VARCHAR( 200 ) -- superviser 2, optional
                , tcm_member_1 VARCHAR( 200 ) -- Can be null at the time of inserting a query.
                , tcm_member_2 VARCHAR( 200 ) -- optional
                , tcm_member_3 VARCHAR( 200 ) -- optional
                , tcm_member_4 VARCHAR( 200 ) -- optional
                , scheduled_on DATE
                , title VARCHAR( 1000 )
                , abstract MEDIUMTEXT
                , status ENUM( 'PENDING', 'APPROVED', 'REJECTED', 'INVALID', 'CANCELLED' ) DEFAULT 'PENDING'
                , modidfied_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )"
            );

        // This table keeps request for scheduling AWS. Do not allow deleting a
        // request. It can be rejected or marked expired.
        $res = $this->query( "
            create TABLE IF NOT EXISTS aws_scheduling_request (
                id INT NOT NULL AUTO_INCREMENT PRIMARY KEY
                , created_on DATETIME
                , speaker VARCHAR(200) NOT NULL
                , first_preference DATE
                , second_preference DATE
                , reason TEXT NOT NULL
                , status ENUM( 'APPROVED', 'REJECTED', 'PENDING', 'CANCELLED' ) DEFAULT 'PENDING'
                )"
            );

        // Generic table for making some task appear in some time interval.
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS conditional_tasks (
                id VARCHAR(50) PRIMARY KEY NOT NULL
                , start_date DATE NOT NULL
                , end_date DATE
                , status ENUM( 'VALID', 'INVALID' ) DEFAULT 'VALID'
                , comment TEXT
            )"
            );
        // This entry keeps track if course registraction should be open/closed for
        // current semester.
        $res = $this->query( "
            INSERT IGNORE INTO conditional_tasks (id) VALUES ('COURSE_REGISTRATION')
            ");

        // Questionnaire
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS question_bank (
                id INT PRIMARY KEY
                , category VARCHAR(40) NOT NULL
                , subcategory VARCHAR(40)
                , question MEDIUMTEXT NOT NULL 
                , choices VARCHAR(500) 
                , status ENUM('VALID', 'INVALID' ) default 'VALID'
                , last_modified_on DATETIME
                )"
            );

        // table to record poll.
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS poll_response (
                login VARCHAR(40) NOT NULL
                , question_id INT NOT NULL
                , external_id VARCHAR(100) NOT NULL -- e.g. COURSEID.SEMESTER.YEAR
                , response VARCHAR(1000) NOT NULL -- it could be large text but no longer than 1000 char.
                , status ENUM('VALID', 'INVALID', 'WITHDRAWN' ) default 'VALID'
                , timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                , last_modified_on DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
                , UNIQUE KEY(login,question_id,external_id)
                )"
            );

        // table to record noticeboard.
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS notice_board (
                id INT NOT NULL
                , login VARCHAR(40) NOT NULL
                , external_id VARCHAR(50) NOT NULL -- e.g. JCID etc.
                , message TEXT
                , status ENUM('VALID', 'INVALID', 'EXPIRED' ) default 'VALID'
                , timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                , last_modified_on DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
                )"
            );

        // Slots
        $res = $this->query( "
            create TABLE IF NOT EXISTS slots (
                id VARCHAR(4) NOT NULL
                , groupid INT NOT NULL
                , day ENUM( 'MON','TUE','WED','THU','FRI','SAT') NOT NULL
                , start_time TIME NOT NULL
                , end_time TIME NOT NULL
                , UNIQUE KEY (day,start_time,end_time)
                , PRIMARY KEY (id,groupid)
                )"
            );

        // list of courses.
        $res = $this->query( "
            create TABLE IF NOT EXISTS courses_metadata  (
                id VARCHAR(8) NOT NULL PRIMARY KEY
                , credits INT NOT NULL DEFAULT 3
                , name VARCHAR(100) NOT NULL
                , description TEXT
                , instructor_1 VARCHAR(50) NOT NULL -- primary instructor.
                , instructor_2 VARCHAR(50)
                , instructor_3 VARCHAR(50)
                , instructor_4 VARCHAR(50)
                , instructor_5 VARCHAR(50)
                , instructor_6 VARCHAR(50)
                , instructor_extras VARCHAR(500) -- comma separated list of extra
                , comment VARCHAR(100)
                )
            ");

        // Instance of running courses.
        $res = $this->query( "
            create TABLE IF NOT EXISTS courses (
                 -- Combination of course code, semester and year
                id VARCHAR(30) PRIMARY KEY
                , semester ENUM( 'AUTUMN', 'SPRING') NOT NULL
                , year VARCHAR(5) NOT NULL
                , course_id VARCHAR(20) NOT NULL
                , start_date DATE NOT NULL
                , end_date DATE NOT NULL
                , venue VARCHAR(20)
                , slot VARCHAR(4)   -- Running in this slot.
                , ignore_tiles VARCHAR(20) -- CSV, ignore these tiles.
                , note VARCHAR(200) DEFAULT ''  -- Add extra comment.
                , UNIQUE KEY(semester,year,course_id)
                )" );



        // Timetable
        $res = $this->query( "
            create TABLE IF NOT EXISTS course_timetable  (
                course VARCHAR(20) NOT NULL
                , start_date DATE NOT NULL
                , end_date DATE NOT NULL
                , slot VARCHAR(5) NOT NULL
                , PRIMARY KEY (course,start_date)
                ) "
            );

        // course registration.
        $res = $this->query( "
            create TABLE IF NOT EXISTS course_registration  (
                 student_id VARCHAR(50) NOT NULL
                , semester ENUM ( 'AUTUMN', 'SPRING' ) NOT NULL
                , year VARCHAR(5) NOT NULL
                -- CHECK contraints are ignored by MYSQL.
                , course_id VARCHAR(8) NOT NULL CHECK ( course_id <> '' )
                , type ENUM( 'AUDIT', 'CREDIT' ) NOT NULL DEFAULT 'CREDIT'
                , status ENUM ( 'VALID', 'INVALID', 'DROPPED' ) NOT NULL DEFAULT 'VALID'
                , registered_on DATETIME NOT NULL
                , last_modified_on DATETIME
                , grade VARCHAR(2)
                , grade_is_given_on DATETIME  -- Do not show till feedback is given.
                , PRIMARY KEY (student_id,semester,year,course_id)
                ) "
            );

        // DEPRECATED: TOLET.
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS apartments (
                id INT PRIMARY KEY
                , type ENUM( 'SHARE', 'SINGLE', '1BHK', '2BHK', '3BHK', '3+BHK' )
                , available_from DATE NOT NULL
                , open_vacancies INT DEFAULT '1'
                , address VARCHAR( 200 ) NOT NULL
                , description MEDIUMTEXT
                , status ENUM( 'AVAILABLE', 'TAKEN', 'WITHDRAWN', 'INVALID', 'EXPIRED' )
                        DEFAULT 'AVAILABLE'
                , owner_contact VARCHAR(200) NOT NULL
                , rent INT NOT NULL
                , advance INT NOT NULL DEFAULT '0'
                , created_by VARCHAR(50) NOT NULL -- Email of owner
                , created_on DATETIME NOT NULL -- timestamp
                , last_modified_on DATETIME
                )"
            );

        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS apartment_comments (
                    id INT PRIMARY KEY AUTO_INCREMENT
                    , login VARCHAR(20)
                    , apartment_id INT NOT NULL
                    , comment VARCHAR(500) NOT NULL
                    , timestamp DATETIME
                )"
            );

        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS alerts (
                login VARCHAR(50) NOT NULL
                , on_table VARCHAR(50) NOT NULL
                , on_field VARCHAR(50) NOT NULL
                , value VARCHAR(50) NOT NULL
                , UNIQUE KEY (login,on_table,on_field,value)
            )"
            );



        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS upcoming_course_schedule (
                id INT NOT NULL AUTO_INCREMENT PRIMARY KEY
                , course_id VARCHAR(100) NOT NULL
                , slot VARCHAR(10) NOT NULL
                , venue VARCHAR(50) NOT NULL
                , weight INT DEFAULT 10
                , alloted_slot VARCHAR(10)
                , alloted_venue VARCHAR(50)
                , comment VARCHAR(200)
                , status ENUM( 'VALID', 'INVALID', 'DELETED' ) DEFAULT 'VALID'
                , UNIQUE KEY(course_id,slot,venue)
                )"
            );

        // This table keep journal club subscription
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS journal_clubs (
                id VARCHAR(100) NOT NULL PRIMARY KEY
                , title VARCHAR(200) NOT NULL
                , status SET( 'ACTIVE', 'INVALID', 'INACTIVE' ) DEFAULT 'ACTIVE'
                , day ENUM( 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN' ) NOT NULL
                , venue VARCHAR(100) NOT NULL
                , time TIME
                , description TEXT
                , scheduling_method ENUM( 'DONT SCHEDULE', 'RANDOM', 'ALPHABETICAL', 'DAYS_ON_CAMPUS', 'NUM_JC_SO_FAR' 
                    ) DEFAULT 'RANDOM'
                , send_email_on_days VARCHAR(30) -- csv list otherwise 3 days before the day
                , UNIQUE KEY(id,day,time,venue)
                )"
            );

        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS jc_subscriptions (
                login VARCHAR(100) NOT NULL
                , jc_id VARCHAR(100) NOT NULL
                , status ENUM( 'VALID', 'INVALID', 'UNSUBSCRIBED' ) DEFAULT 'VALID'
                , subscription_type SET( 'NORMAL', 'ADMIN' ) DEFAULT 'NORMAL'
                , last_modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                , UNIQUE KEY(login,jc_id)
                )"
            );

        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS jc_presentations (
                id INT NOT NULL PRIMARY KEY
                , jc_id VARCHAR(100) NOT NULL
                , title VARCHAR(300) NOT NULL
                , presenter VARCHAR(100) NOT NULL -- login from logins table.
                , description TEXT
                , date DATE NOT NULL
                , time TIME NOT NULL -- usually the default time from journal_club.
                , venue VARCHAR(30) NOT NULL -- usually the default venue from journal_clubs
                , status ENUM( 'VALID', 'INVALID', 'CANCELLED' ) default 'VALID'
                , url VARCHAR(500) -- URL of paper
                , presentation_url VARCHAR(500) -- URL of presentation
                , UNIQUE KEY(presenter,jc_id,date)
                )"
            );

        // Not put many contraints.
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS jc_requests (
                id INT NOT NULL PRIMARY KEY
                , jc_id VARCHAR(100) NOT NULL
                , presenter VARCHAR(100) NOT NULL -- login from logins
                , title VARCHAR(300) NOT NULL
                , description TEXT
                , date DATE NOT NULL
                , url VARCHAR(500) -- Paper URL.
                , status SET( 'VALID', 'INVALID', 'CANCELLED' ) DEFAULT 'VALID'
                , acknowledged ENUM('YES', 'NO') DEFAULT 'YES'
                )"
            );

        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS votes (
                id VARCHAR(50) NOT NULL  -- table.id
                , voter VARCHAR(20) NOT NULL
                , status SET( 'VALID', 'INVALID', 'CANCELLED' ) DEFAULT 'VALID'
                , voted_on DATE
                , UNIQUE KEY(voter,id)
                )"
            );

        // inventroy
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS inventory (
                id INT PRIMARY KEY
                , name VARCHAR(50) NOT NULL
                , scientific_name VARCHAR(100)
                , vendor VARCHAR(100) NOT NULL
                , quantity_with_unit VARCHAR(40) NOT NULL default '1 nos'
                , description TEXT
                , status ENUM( 'VALID', 'INVALID', 'DELETED' ) DEFAULT 'VALID'
                , item_condition ENUM('FUNCTIONAL', 'DSYFUNCTIONAL', 'LOST', 'EXPIRED', 'UNKNOWN') default 'FUNCTIONAL'
                , expiry_date DATETIME   -- send reminder 1 month in advance.
                , last_modified_on DATETIME
                , edited_by VARCHAR(100) default 'HIPPO'
                , person_in_charge VARCHAR(200) NOT NULL -- could be multiple.
                , faculty_in_charge VARCHAR(100) NOT NULL -- could be multiple faculty 
                , requires_booking ENUM('YES', 'NO') default 'NO'
                , UNIQUE KEY (faculty_in_charge, name)
                )"
            );

        // Equipements booking.
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS inventory_bookings (
                id INT PRIMARY KEY
                , inventory_id INT NOT NULL
                , date DATE NOT NULL
                , start_time TIME NOT NULL
                , end_time TIME NOT NULL
                , booked_by VARCHAR(50) NOT NULL
                , status ENUM('VALID', 'INVALID', 'CANCELLED') DEFAULT 'VALID'
                , comment VARCHAR(200)
                , created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                , modified_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
                )"
            );

        // Clickable queries
        $res = $this->query( "
            CREATE TABLE IF NOT EXISTS queries (
                id INT PRIMARY KEY
                , external_id VARCHAR(50) DEFAULT 'NONE.-1' -- associated table.id in some other table
                , who_can_execute VARCHAR(100) NOT NULL -- which login can execute.
                , query VARCHAR(300) NOT NULL -- query to execute.
                , status ENUM( 'EXECUTED', 'INVALID', 'PENDING' ) DEFAULT 'PENDING'
                , last_modified_on DATETIME
                , edited_by VARCHAR(100) default 'HIPPO'
                )"
            );

        return $res;
    }
}


// Construct the PDO
// And initiaze the database.
$hippoDB = new BMVPDO( "localhost" );
$hippoDB->initialize();

?>
